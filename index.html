<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù‚ÛŒÙ…Øª Ø®ÙˆØ¯Ø±Ùˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="bg-white shadow-lg rounded-xl p-6 w-full max-w-lg">
      <h1 class="text-2xl font-bold mb-6 text-center">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù‚ÛŒÙ…Øª Ø®ÙˆØ¯Ø±Ùˆ</h1>

      <form id="carForm" class="space-y-4">
        <div>
          <label class="block mb-1">Ù†Ø§Ù… Ø®ÙˆØ¯Ø±Ùˆ</label>
          <select id="carSelect" name="car_name" class="w-full border rounded px-3 py-2" required>
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
            <option value="Ø§Ø·Ù„Ø³">Ø§Ø·Ù„Ø³</option>
            <option value="ØªØ§Ø±Ø§">ØªØ§Ø±Ø§</option>
            <option value="Ø¯Ù†Ø§">Ø¯Ù†Ø§</option>
            <option value="Ø±Ø§Ù†Ø§">Ø±Ø§Ù†Ø§</option>
            <option value="Ø³Ø§ÛŒÙ†Ø§">Ø³Ø§ÛŒÙ†Ø§</option>
            <option value="Ø³Ù…Ù†Ø¯">Ø³Ù…Ù†Ø¯</option>
            <option value="Ø´Ø§Ù‡ÛŒÙ†">Ø´Ø§Ù‡ÛŒÙ†</option>
            <option value="Ù¾Ø±Ø§ÛŒØ¯">Ù¾Ø±Ø§ÛŒØ¯</option>
            <option value="Ù¾Ú˜Ùˆ">Ù¾Ú˜Ùˆ</option>
            <option value="Ú©ÙˆÛŒÛŒÚ©">Ú©ÙˆÛŒÛŒÚ©</option>
          </select>
        </div>

        <div>
          <label class="block mb-1">Ù…Ø¯Ù„</label>
          <select id="modelSelect" name="model" class="w-full border rounded px-3 py-2" required>
            <option value="">Ø§Ø¨ØªØ¯Ø§ Ø®ÙˆØ¯Ø±Ùˆ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
          </select>
        </div>

        <div>
          <label class="block mb-1">Ú©ÛŒÙ„ÙˆÙ…ØªØ±</label>
          <input type="number" name="kilometer" class="w-full border rounded px-3 py-2" placeholder="Ù…Ø«Ù„Ø§Ù‹ 58000" required>
        </div>

        <div>
          <label class="block mb-1">Ø±Ù†Ú¯</label>
          <select name="color" class="w-full border rounded px-3 py-2" required>
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
            <option value="Ø³ÙÛŒØ¯">Ø³ÙÛŒØ¯</option>
            <option value="Ù…Ø´Ú©ÛŒ">Ù…Ø´Ú©ÛŒ</option>
            <option value="Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ">Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ</option>
            <option value="Ù‚Ø±Ù…Ø²">Ù‚Ø±Ù…Ø²</option>
            <option value="Ø®Ø§Ú©Ø³ØªØ±ÛŒ">Ø®Ø§Ú©Ø³ØªØ±ÛŒ</option>
            <option value="Ø¨Ú˜">Ø¨Ú˜</option>
            <option value="Ø¢Ø¨ÛŒ">Ø¢Ø¨ÛŒ</option>
            <option value="Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ">Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ</option>
            <option value="Ø³Ø¨Ø²">Ø³Ø¨Ø²</option>
            <option value="Ø²Ø±Ø¯">Ø²Ø±Ø¯</option>
            <option value="Ø¨Ù†ÙØ´">Ø¨Ù†ÙØ´</option>
          </select>
        </div>

        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù‚ÛŒÙ…Øª</button>
      </form>

      <div id="result" class="mt-6 text-center text-lg font-semibold"></div>
      <canvas id="chart" class="mt-4"></canvas>
    </div>
  </div>

  <script>
    const modelsByCar = {
      "Ø§Ø·Ù„Ø³": ["E", "G", "S"],
      "ØªØ§Ø±Ø§": ["G", "vÛ± Ù¾Ù„Ø§Ø³", "Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©", "Ø¯Ù†Ø¯Ù‡ Ø§ÛŒ", "ÙˆÛŒ Û´ Ø§Ù„ Ø§ÛŒÚ©Ø³"],
      "Ø¯Ù†Ø§": ["G", "Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³", "Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³ ØªÙˆØ±Ø¨Ùˆ", "Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³ ØªÛŒÙ¾ Û± ØªÙˆØ±Ø¨Ùˆ", "Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³ ØªÛŒÙ¾ Û± Ø¯Ù†Ø¯Ù‡â€ŒØ§ÛŒ", "Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³ ØªÛŒÙ¾ Û² ØªÙˆØ±Ø¨Ùˆ", "Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³ ØªÛŒÙ¾ Û² Ø¯Ù†Ø¯Ù‡â€ŒØ§ÛŒ", "Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³ Ûµ Ø¯Ù†Ø¯Ù‡ ØªÙˆØ±Ø¨Ùˆ", "Ø¯Ù†Ø§ Ù¾Ù„Ø§Ø³ Û¶ Ø¯Ù†Ø¯Ù‡ ØªÙˆØ±Ø¨Ùˆ"],
      "Ø±Ø§Ù†Ø§": ["EL", "LX", "Ù¾Ù„Ø§Ø³", "Ù¾Ù„Ø§Ø³ Ù¾Ø§Ù†ÙˆØ±Ø§Ù…Ø§"],
      "Ø³Ø§ÛŒÙ†Ø§": ["G", "GX", "Ø¯Ù†Ø¯Ù‡ Ø§ÛŒ", "Ø³Ø§ÛŒÙ†Ø§ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© EX", "Ø³Ø§ÛŒÙ†Ø§ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© S", "Ø³Ø§ÛŒÙ†Ø§ Ø¯Ù†Ø¯Ù‡ Ø§ÛŒ EX", "Ø³Ø§ÛŒÙ†Ø§ Ø¯Ù†Ø¯Ù‡ Ø§ÛŒ G", "Ø³Ø§ÛŒÙ†Ø§ Ø¯Ù†Ø¯Ù‡ Ø§ÛŒ S", "Ø³Ø§ÛŒÙ†Ø§ Ø¯Ù†Ø¯Ù‡ Ø§ÛŒ SX"],
      "Ø³Ù…Ù†Ø¯": ["EL (Ø¨Ù†Ø²ÛŒÙ†ÛŒ)", "EL (Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø³ÙˆØ²)", "LX (Ø³Ø§Ø¯Ù‡)", "LX EFÛ· (Ø¨Ù†Ø²ÛŒÙ†ÛŒ)", "LX EFÛ· (Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø³ÙˆØ²)", "SE", "XÛ· (Ø¨Ù†Ø²ÛŒÙ†ÛŒ)", "XÛ· (Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø³ÙˆØ²)", "Ø³Ø±ÛŒØ±", "Ø³ÙˆØ±Ù† (ELX ØªÙˆØ±Ø¨Ùˆ)", "Ø³ÙˆØ±Ù† (ELX)", "Ø³ÙˆØ±Ù† (Ø³Ø§Ø¯Ù‡)", "Ø³ÙˆØ±Ù† (Ù¾Ù„Ø§Ø³)", "Ù…Ø¹Ù…ÙˆÙ„ÛŒ"],
      "Ø´Ø§Ù‡ÛŒÙ†": ["G", "GL", "Ù¾Ù„Ø§Ø³"],
      "Ù¾Ø±Ø§ÛŒØ¯": ["Ø³ÙØ±ÛŒ", "ØµØ¨Ø§ (ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±) (Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø³ÙˆØ²)", "ØµØ¨Ø§ (ØµÙ†Ø¯ÙˆÙ‚Ø¯Ø§Ø±) Ø¨Ù†Ø²ÛŒÙ†ÛŒ", "Ù†Ø³ÛŒÙ… (Ù‡Ø§Ú† Ø¨Ú©)", "ÙˆØ§Ù†Øª (Û±ÛµÛ±) (Ø¨Ù†Ø²ÛŒÙ†ÛŒ)", "ÙˆØ§Ù†Øª (Û±ÛµÛ±) (Ù¾Ù„Ø§Ø³)", "ÙˆØ§Ù†Øª Û±ÛµÛ± (Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø³ÙˆØ²)", "Û±Û±Û±", "Û±Û±Û± se", "Û±Û±Û± sl", "Û±Û±Û± sx", "Û±Û³Û± (Ø¨Ù†Ø²ÛŒÙ†ÛŒ)", "Û±Û³Û± (Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø³ÙˆØ²)", "Û±Û³Û± se", "Û±Û³Û± sl", "Û±Û³Û± sx", "Û±Û³Û± tl", "Û±Û³Û² (Ø¨Ù†Ø²ÛŒÙ†ÛŒ)", "Û±Û³Û² (Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø³ÙˆØ²)", "Û±Û³Û² se", "Û±Û´Û± (Ø¨Ù†Ø²ÛŒÙ†ÛŒ)", "Û±Û´Û± (Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø³ÙˆØ²)", "Û±Û´Û± i", "Û±Û´Û± le", "Û±Û´Û± sx"],
      "Ù¾Ú˜Ùˆ": ["Û²Û°Û¶ (ØªÛŒÙ¾Û±)","Û²Û°Û¶ (ØªÛŒÙ¾Û²)","Û²Û°Û¶ (ØªÛŒÙ¾Û³)","Û²Û°Û¶ (ØªÛŒÙ¾Û³) Ù¾Ø§Ù†ÙˆØ±Ø§Ù…Ø§","Û²Û°Û¶ (ØªÛŒÙ¾Û´)","Û²Û°Û¶ (ØªÛŒÙ¾Ûµ)","Û²Û°Û¶ (ØªÛŒÙ¾Û¶)","Û²Û°Û·i (MC)","Û²Û°Û·i (Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©)","Û²Û°Û·i (Ø¯Ù†Ø¯Ù‡ Ø§ÛŒ)","Û²Û°Û·i (Ù¾Ø§Ù†ÙˆØ±Ø§Ù…Ø§ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© TUÛµ)","Û²Û°Û·i (Ù¾Ø§Ù†ÙˆØ±Ø§Ù…Ø§ Ø¯Ù†Ø¯Ù‡ Ø§ÛŒ)","Û²Û°Û·i Ø¯Ù†Ø¯Ù‡â€ŒØ§ÛŒ TUÛ³","Û²Û°Û·i Ù¾Ø§Ù†ÙˆØ±Ø§Ù…Ø§ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©"],
      "Ú©ÙˆÛŒÛŒÚ©": ["G","R","R Ù¾Ù„Ø§Ø³","S","Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© R Ù¾Ù„Ø§Ø³","Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© S","Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© ÙÙˆÙ„ Ù¾Ù„Ø§Ø³","Ø³Ø§Ø¯Ù‡","Ù¾Ù„Ø§Ø³"]
    };

    const carSelect = document.getElementById("carSelect");
    const modelSelect = document.getElementById("modelSelect");

    carSelect.addEventListener("change", () => {
      const car = carSelect.value;
      modelSelect.innerHTML = "<option value=''>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>";
      if(modelsByCar[car]){
        modelsByCar[car].forEach(m => {
          const opt = document.createElement("option");
          opt.value = m;
          opt.textContent = m;
          modelSelect.appendChild(opt);
        });
      }
    });

    const form = document.getElementById("carForm");
    const resultDiv = document.getElementById("result");
    const ctx = document.getElementById("chart").getContext("2d");
    let chart;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      resultDiv.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ...";
      
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      data.zero_km = data.kilometer == 0 ? 1 : 0;
      data.km_per_year = Math.floor(data.kilometer / (1404 - data.year || 1));
      data.is_automatic = ["Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©","Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© R Ù¾Ù„Ø§Ø³","Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© S","Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© ÙÙˆÙ„ Ù¾Ù„Ø§Ø³"].includes(data.model) ? 1 : 0;

      try {
        const response = await fetch("https://web-production-3e601.up.railway.app/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await response.json();

        if(result.success){
          // Ú†Ú© Ú©Ù†ÛŒÙ… metrics ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡
          const r2 = result.metrics?.test?.r2_score ?? "N/A";
          const mae = result.metrics?.test?.mae ?? "N/A";

          resultDiv.innerHTML = `ğŸ’° Ù‚ÛŒÙ…Øª Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø´Ø¯Ù‡: ${result.formatted_price} ØªÙˆÙ…Ø§Ù†<br>
          ğŸ“Š Ø¯Ù‚Øª Ù…Ø¯Ù„: RÂ² ~ ${r2}, MAE ~ ${mae} ØªÙˆÙ…Ø§Ù†`;

          const chartData = {
            labels: ["Ø­Ø¯Ø§Ù‚Ù„","Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ","Ø­Ø¯Ø§Ú©Ø«Ø±"],
            datasets: [{
              label: "Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)",
              data: [result.confidence.min, result.predicted_price, result.confidence.max],
              backgroundColor: ["#f87171","#60a5fa","#34d399"]
            }]
          };
          if(chart) chart.destroy();
          chart = new Chart(ctx, { type: "bar", data: chartData, options: { responsive: true }});
        } else {
          resultDiv.textContent = `âŒ Ø®Ø·Ø§: ${result.errors?.join(', ') || result.message || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡"}`;
        }

      } catch (err) {
        resultDiv.textContent = `âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±`;
        console.error(err);
      }
    });
  </script>
</body>
</html>
